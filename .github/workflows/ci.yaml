name: CI

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  # lint:
  #   name: "lint / ruff"
  #   runs-on: ubuntu-latest

  #   steps:
  #     - uses: actions/checkout@v4

  #     - uses: prefix-dev/setup-pixi@v0.8.1
  #       with:
  #         pixi-version: latest
  #         environments: default
  #         cache: true

  #     - name: Ruff check
  #       run: pixi run lint_check

  #     - name: Ruff format check
  #       run: pixi run lint_format --check

  test:
    name: "test / ${{ matrix.os }} / py${{ matrix.env }}"
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        env: [py311, py312, py313]

    steps:
      - uses: actions/checkout@v4
        with:
          # Full history needed for hatch-vcs to derive the version from git tags
          fetch-depth: 0

      - uses: prefix-dev/setup-pixi@v0.8.1
        with:
          pixi-version: latest
          environments: ${{ matrix.env }}
          cache: false

      - name: Run tests
        run: pixi run -e ${{ matrix.env }} pytest_run
